#!/bin/bash

# Local & Public IP
LOCAL_IP=$(hostname -I | awk '{print $1}')
PUBLIC_IP=$(curl -s ifconfig.me)

# Tailscale IP
if command -v tailscale &> /dev/null; then
    TAILSCALE_IP=$(tailscale ip -4 2>/dev/null | head -n1)
    TAILSCALE_IP="${TAILSCALE_IP:-N/A}"
else
    TAILSCALE_IP="N/A"
fi

# CPU Temp
CPU_TEMP=$(sensors | awk '/^Package id 0:/ {print $4}')

# CPU Usage
CPU_USE=$(top -bn1 | grep "Cpu(s)" | awk '{print 100 - $8"%"}')

# Memory Usage
MEM_USE=$(free -m | awk '/Mem:/ {printf "%dMB / %dMB (%.1f%%)", $3, $2, $3*100/$2}')

# Intel iGPU Usage (instant snapshot)
if command -v intel_gpu_top &> /dev/null; then
    GPU_USE=$(timeout 0.5 intel_gpu_top -J 2>/dev/null | jq -r '.engines[] | select(.class=="Render/3D") | .busy' | head -n1)
    GPU_USE="${GPU_USE:-0}%"
else
    GPU_USE="N/A"
fi

# Disk Usage
DISK_USE=$(df -h / | awk 'NR==2 {print $3 " / " $2 " (" $5 ")"}')

echo "----------------------------------------"
printf " %-12s : %-20s | %-12s : %-20s\n" "Welcome" "$USER" "Local IP" "$LOCAL_IP"
printf " %-12s : %-20s | %-12s : %-20s\n" "Public IP" "$PUBLIC_IP" "Tailscale" "$TAILSCALE_IP"
printf " %-12s : %-20s | %-12s : %-20s\n" "CPU Temp" "$CPU_TEMP" "CPU Usage" "$CPU_USE"
printf " %-12s : %-20s | %-12s : %-20s\n" "Memory" "$MEM_USE" "GPU Usage" "$GPU_USE"
printf " %-12s : %-20s\n" "Disk Root" "$DISK_USE"
echo "----------------------------------------"